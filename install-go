#!/bin/bash
set -e

URL="https://mirrors.ustc.edu.cn/golang/go1.9.5.linux-amd64.tar.gz"

function postInstall() {
    # post install some go tools
    export GOROOT="$HOME/go"
    export GOPATH="$HOME/gos"
    export PATH="$GOROOT/bin:$GOPATH/bin:$PATH"

    echo 'Installing gotags...'
    go get -u github.com/jstemmer/gotags

    echo 'Installing godef...'
    go get -u github.com/rogpeppe/godef

    echo 'Installing govendor...'
    go get -u github.com/kardianos/govendor

    echo "Installing delve..."
    go get -u github.com/derekparker/delve/cmd/dlv
}

function alreadyInstalled() {
    if [ -e ~/go ]; then
        echo 'golang already installed. exit'
        exit 1
    fi
}

function downloadAndInstallGo() {
    GO=`basename $URL`
    chkfile='sha256.txt'

    wget $URL --no-check-certificate -O $GO
    echo $GO

    wget "${URL}.sha256" -O $chkfile

    echo 'Checking sha256'
    echo "`cat $chkfile`  $GO" |  sha256sum --check -
    rm $chkfile

    tar xzf $GO
    mv -v go ~/
    mkdir ~/gos
    rm $GO
}


alreadyInstalled
downloadAndInstallGo
postInstall

# All is ok
echo 'Go install finished..'
echo 'Please copy bashrc into $HOME dir to make go work'

